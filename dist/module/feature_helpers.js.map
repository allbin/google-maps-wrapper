{"version":3,"sources":["../src/module/feature_helpers.ts"],"names":[],"mappings":"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","file":"feature_helpers.js","sourcesContent":["import { panZoomToObjectOrFeature } from \"./internal_helpers\";\n\nconst feature_events: FeatureEvents[] = [\n  \"click\",\n  \"mouseover\",\n  \"mouseout\",\n  \"mousedown\",\n  \"mouseup\",\n  \"rightclick\",\n];\n\nexport const setupLayerEvents = (\n  map_objects: MapObjects,\n  layer: google.maps.Data\n): void => {\n  feature_events.forEach((event_type) => {\n    layer.addListener(\n      event_type,\n      (data_mouse_event: google.maps.Data.MouseEvent) => {\n        const feature_id = data_mouse_event.feature.getId();\n        const wrapped_feature = map_objects.features[feature_id];\n        if (wrapped_feature && wrapped_feature._cbs[event_type]) {\n          wrapped_feature._cbs[event_type](data_mouse_event);\n        }\n      }\n    );\n  });\n};\n\nconst wrapGmapsFeature = (\n  map: google.maps.Map,\n  map_objects: MapObjects,\n  layer: google.maps.Data,\n  gmaps_feature: google.maps.Data.Feature,\n  options: FeatureOptionsSet\n): WrappedFeature => {\n  interface WrappedFeatureShell extends Partial<WrappedFeature> {\n    gmaps_feature: google.maps.Data.Feature;\n    options: FeatureOptionsSet;\n    selected_options_id: string;\n    _visible: boolean;\n    _cbs: { [key: string]: (e: google.maps.Data.MouseEvent) => void };\n    _bbox: google.maps.LatLngBounds;\n  }\n\n  const wrapped_feature: WrappedFeatureShell = {\n    gmaps_feature: gmaps_feature,\n    options: options,\n    selected_options_id: \"default\",\n    _visible:\n      options.default.visible !== undefined ? options.default.visible : true,\n    _cbs: {},\n    _bbox: new window.google.maps.LatLngBounds(),\n  };\n  gmaps_feature.getGeometry().forEachLatLng((point) => {\n    wrapped_feature._bbox.extend(point);\n  });\n  wrapped_feature.setOptions = (new_options: FeatureOptionsSet) => {\n    wrapped_feature.options = new_options;\n    return Promise.resolve(wrapped_feature as WrappedFeature);\n  };\n  wrapped_feature.applyOptions = (options_id: string) => {\n    if (!Object.prototype.hasOwnProperty.call(options, options_id)) {\n      throw new Error(\n        \"Tried to applyOptions(options_id) with '\" +\n          options_id +\n          \"', but options for given id are not defined.\"\n      );\n    }\n    wrapped_feature.selected_options_id = options_id;\n    const new_options = Object.assign(\n      {},\n      options.default,\n      options[wrapped_feature.selected_options_id],\n      { visible: wrapped_feature._visible }\n    );\n    layer.overrideStyle(gmaps_feature, new_options);\n  };\n  wrapped_feature.show = () => {\n    if (!wrapped_feature._visible && wrapped_feature.applyOptions) {\n      wrapped_feature._visible = true;\n      wrapped_feature.applyOptions(wrapped_feature.selected_options_id);\n    }\n  };\n  wrapped_feature.hide = () => {\n    if (wrapped_feature._visible && wrapped_feature.applyOptions) {\n      wrapped_feature._visible = false;\n      wrapped_feature.applyOptions(wrapped_feature.selected_options_id);\n    }\n  };\n  wrapped_feature.remove = () => {\n    layer.remove(gmaps_feature);\n  };\n  wrapped_feature.registerEventCB = (event_type, cb) => {\n    wrapped_feature._cbs[event_type] = cb;\n  };\n  wrapped_feature.unregisterEventCB = (event_type) => {\n    delete wrapped_feature._cbs[event_type];\n  };\n  wrapped_feature.zoomTo = () => {\n    panZoomToObjectOrFeature(map, wrapped_feature as WrappedFeature, true);\n  };\n  wrapped_feature.panTo = () => {\n    panZoomToObjectOrFeature(map, wrapped_feature as WrappedFeature, false);\n  };\n\n  wrapped_feature.applyOptions(\"default\");\n\n  return (wrapped_feature as unknown) as WrappedFeature;\n};\n\nexport const setGeoJSONFeature = (\n  map: google.maps.Map,\n  map_objects: MapObjects,\n  features_layer: google.maps.Data,\n  feature: GeoJSONFeature,\n  options: FeatureOptionsSet,\n  layer?: google.maps.Data\n): Promise<WrappedFeature> =>\n  new Promise((resolve, reject) => {\n    if (\n      Object.prototype.hasOwnProperty.call(map_objects.features, feature.id)\n    ) {\n      const wrapped_feature = map_objects.features[feature.id];\n      wrapped_feature.remove();\n    }\n\n    if (!layer) {\n      if (!features_layer) {\n        return reject(\n          \"Internal error in map wrapper: Features layer not created.\"\n        );\n      }\n    }\n    const feature_layer = features_layer;\n    const gmaps_feature = feature_layer.addGeoJson(feature)[0];\n    const wrapped_feature = wrapGmapsFeature(\n      map,\n      map_objects,\n      feature_layer,\n      gmaps_feature,\n      options\n    );\n    map_objects.features[feature.id] = wrapped_feature;\n    resolve(wrapped_feature);\n  });\n\nexport const setGeoJSONCollection = (\n  map: google.maps.Map,\n  map_objects: MapObjects,\n  collection: GeoJSONFeatureCollection,\n  options: FeatureOptionsSet\n): Promise<{\n  layer: google.maps.Data;\n  features: WrappedFeature[];\n}> =>\n  new Promise((resolve) => {\n    const layer = new window.google.maps.Data() as google.maps.Data;\n    layer.setMap(map);\n    setupLayerEvents(map_objects, layer);\n\n    const features: WrappedFeature[] = layer\n      .addGeoJson(collection)\n      .map((gmaps_feature) => {\n        const wrapped_feature = wrapGmapsFeature(\n          map,\n          map_objects,\n          layer,\n          gmaps_feature,\n          options\n        );\n        map_objects.features[gmaps_feature.getId()] = wrapped_feature;\n        return wrapped_feature;\n      });\n\n    layer.setStyle(options.default);\n    resolve({\n      layer: layer,\n      features: features,\n    });\n  });\n"]}