{"version":3,"sources":["../src/module/feature_helpers.ts"],"names":[],"mappings":";AAAA,OAAO,cAAc,EAAE,EAAE,wBAAwB,EAAE,iBAAiB,EAAE,cAAc,EAAE,cAAc,EAAiB,MAAM,GAAG,CAAC;AAI/H,aAAK,gBAAgB,GAAG,CACpB,OAAO,EAAE,cAAc,EACvB,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,KACtB,IAAI,CAAC;AACV,eAAO,MAAM,gBAAgB,EAAE,gBAU9B,CAAC;AA8DF,aAAK,iBAAiB,GAAG,CACrB,OAAO,EAAE,cAAc,EACvB,OAAO,EAAE,cAAc,EACvB,OAAO,EAAE,iBAAiB,EAC1B,KAAK,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,GAAG,IAAI,KAC9B,OAAO,CAAC,cAAc,CAAC,CAAC;AAC7B,eAAO,MAAM,iBAAiB,EAAE,iBA6B/B,CAAC;AAEF,aAAK,oBAAoB,GAAG,CACxB,OAAO,EAAE,cAAc,EACvB,UAAU,EAAE,wBAAwB,EACpC,OAAO,EAAE,iBAAiB,KACzB,OAAO,CAAC;IACT,KAAK,EAAE,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;IACxB,QAAQ,EAAE,cAAc,EAAE,CAAA;CAC7B,CAAC,CAAC;AACH,eAAO,MAAM,oBAAoB,EAAE,oBA6BlC,CAAC","file":"feature_helpers.d.ts","sourcesContent":["import WrappedMapBase, { GeoJSONFeatureCollection, FeatureOptionsSet, WrappedFeature, GeoJSONFeature, FeatureEvents } from '.';\n\nconst feature_events: FeatureEvents[] = [\"click\" , \"mouseover\" , \"mouseout\" , \"mousedown\" , \"mouseup\" , \"rightclick\"];\n\ntype setupLayerEvents = (\n    map_ref: WrappedMapBase,\n    layer: google.maps.Data\n) => void;\nexport const setupLayerEvents: setupLayerEvents = (map_ref, layer) => {\n    feature_events.forEach((event_type) => {\n        layer.addListener(event_type, (data_mouse_event: google.maps.Data.MouseEvent) => {\n            const feature_id = data_mouse_event.feature.getId();\n            const wrapped_feature = map_ref.map_objects.features[feature_id];\n            if (wrapped_feature && wrapped_feature._cbs[event_type]) {\n                wrapped_feature._cbs[event_type](data_mouse_event);\n            }\n        });\n    });\n};\n\n\ntype wrapGmapsFeature = (\n    layer: google.maps.Data,\n    gmaps_feature: google.maps.Data.Feature,\n    options: FeatureOptionsSet\n) => WrappedFeature;\nconst wrapGmapsFeature: wrapGmapsFeature = (layer, gmaps_feature, options) => {\n    interface WrappedFeatureShell extends Partial<WrappedFeature> {\n        gmaps_feature: any;\n        options: FeatureOptionsSet;\n        selected_options_id: string;\n        _visible: boolean;\n        _cbs: { [key: string]: (e: google.maps.Data.MouseEvent) => void };\n    }\n\n    let wrapped_feature: WrappedFeatureShell = {\n        gmaps_feature: gmaps_feature,\n        options: options,\n        selected_options_id: 'default',\n        _visible: options.default.visible !== undefined ? options.default.visible : true,\n        _cbs: {}\n    };\n    wrapped_feature.setOptions = (new_options: FeatureOptionsSet) => {\n        wrapped_feature.options = new_options;\n        return Promise.resolve(wrapped_feature as WrappedFeature);\n    };\n    wrapped_feature.applyOptions = (options_id: string) => {\n        wrapped_feature.selected_options_id = options_id;\n        let new_options = Object.assign({}, options.default, options[wrapped_feature.selected_options_id], { visible: wrapped_feature._visible });\n        layer.overrideStyle(gmaps_feature, new_options);\n    };\n    wrapped_feature.show = () => {\n        if (!wrapped_feature._visible && wrapped_feature.applyOptions) {\n            wrapped_feature._visible = true;\n            wrapped_feature.applyOptions(wrapped_feature.selected_options_id);\n        }\n    };\n    wrapped_feature.hide = () => {\n        if (wrapped_feature._visible && wrapped_feature.applyOptions) {\n            wrapped_feature._visible = false;\n            wrapped_feature.applyOptions(wrapped_feature.selected_options_id);\n        }\n    };\n    wrapped_feature.remove = () => {\n        layer.remove(gmaps_feature);\n    };\n    wrapped_feature.registerEventCB = (event_type, cb) => {\n        wrapped_feature._cbs[event_type] = cb;\n    };\n    wrapped_feature.unregisterEventCB = (event_type) => {\n        delete wrapped_feature._cbs[event_type];\n    };\n\n\n    wrapped_feature.applyOptions('default');\n\n    return wrapped_feature as unknown as WrappedFeature;\n};\n\n\ntype setGeoJSONFeature = (\n    map_ref: WrappedMapBase,\n    feature: GeoJSONFeature,\n    options: FeatureOptionsSet,\n    layer?: google.maps.Data | null\n) => Promise<WrappedFeature>;\nexport const setGeoJSONFeature: setGeoJSONFeature = (map_ref, feature, options, layer = null) => {\n    return new Promise((resolve, reject) => {\n        if (!map_ref.initialized) {\n            map_ref.do_after_init.push(() => {\n                setGeoJSONFeature(map_ref, feature, options, layer).then((res) => {\n                    resolve(res);\n                }).catch((err) => {\n                    reject(err);\n                });\n            });\n            return;\n        }\n\n        if (map_ref.map_objects.features.hasOwnProperty(feature.id)) {\n            let wrapped_feature = map_ref.map_objects.features[feature.id];\n            wrapped_feature.remove();\n        }\n\n        if (!layer) {\n            if (!map_ref.features_layer) {\n                reject(\"Internal error in map wrapper: Features layer not created.\");\n            }\n            layer = map_ref.features_layer!;\n        }\n        const gmaps_feature = layer.addGeoJson(feature)[0];\n        const wrapped_feature = wrapGmapsFeature(layer, gmaps_feature, options);\n        map_ref.map_objects.features[feature.id] = wrapped_feature;\n        resolve(wrapped_feature);\n    });\n};\n\ntype setGeoJSONCollection = (\n    map_ref: WrappedMapBase,\n    collection: GeoJSONFeatureCollection,\n    options: FeatureOptionsSet\n) => Promise<{\n    layer: google.maps.Data,\n    features: WrappedFeature[]\n}>;\nexport const setGeoJSONCollection: setGeoJSONCollection = (map_ref, collection, options) => {\n    return new Promise((resolve, reject) => {\n        if (!map_ref.initialized) {\n            map_ref.do_after_init.push(() => {\n                setGeoJSONCollection(map_ref, collection, options).then((res) => {\n                    resolve(res);\n                }).catch((err) => {\n                    reject(err);\n                });\n            });\n            return;\n        }\n\n        let layer = new window.google.maps.Data() as google.maps.Data;\n        layer.setMap(map_ref.map);\n        setupLayerEvents(map_ref, layer);\n\n        let features: WrappedFeature[] = layer.addGeoJson(collection).map((gmaps_feature) => {\n            let wrapped_feature = wrapGmapsFeature(layer, gmaps_feature, options);\n            map_ref.map_objects.features[gmaps_feature.getId()] = wrapped_feature;\n            return wrapped_feature;\n        });\n\n        layer.setStyle(options.default);\n        resolve({\n            layer: layer,\n            features: features\n        });\n    });\n};\n"]}